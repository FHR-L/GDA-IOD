import re
"""
+-------------+------+-------+--------+-------+
| class       | gts  | dets  | recall | ap    |
+-------------+------+-------+--------+-------+
| aeroplane   | 285  | 488   | 0.825  | 0.750 |
| bicycle     | 337  | 948   | 0.908  | 0.826 |
| bird        | 459  | 1010  | 0.856  | 0.772 |
| boat        | 263  | 855   | 0.768  | 0.606 |
| bottle      | 469  | 1063  | 0.785  | 0.646 |
| bus         | 213  | 852   | 0.925  | 0.833 |
| car         | 1201 | 2827  | 0.920  | 0.848 |
| cat         | 358  | 1015  | 0.950  | 0.835 |
| chair       | 756  | 2952  | 0.769  | 0.581 |
| cow         | 244  | 1644  | 0.955  | 0.720 |
| diningtable | 206  | 1938  | 0.913  | 0.655 |
| dog         | 489  | 1779  | 0.971  | 0.792 |
| horse       | 348  | 1187  | 0.937  | 0.822 |
| motorbike   | 325  | 1584  | 0.911  | 0.758 |
| person      | 4528 | 16203 | 0.945  | 0.837 |
| pottedplant | 480  | 3729  | 0.817  | 0.473 |
| sheep       | 242  | 1155  | 0.880  | 0.680 |
| sofa        | 239  | 1776  | 0.929  | 0.671 |
| train       | 282  | 1503  | 0.926  | 0.740 |
| tvmonitor   | 308  | 1873  | 0.922  | 0.767 |
+-------------+------+-------+--------+-------+
| mAP         |      |       |        | 0.731 |
+-------------+------+-------+--------+-------+
"""
# pattern = '10+5'
# pattern = '15+5'
# pattern = '10+10'
# pattern = '19+1'
# pattern = '10+10'
# pattern = '5+15'
# patterns = ['10+5+5', '15+5', '5+15', '19+1', '10+10']
patterns = ['40+40']
map_list = [
"| person         | 0.472 | 0.743  | 0.518  | 0.297 | 0.559 | 0.635 |",
"| bicycle        | 0.252 | 0.51   | 0.209  | 0.117 | 0.319 | 0.496 |",
"| car            | 0.364 | 0.605  | 0.386  | 0.287 | 0.499 | 0.51  |",
"| motorcycle     | 0.33  | 0.639  | 0.295  | 0.177 | 0.313 | 0.464 |",
"| airplane       | 0.448 | 0.77   | 0.489  | 0.478 | 0.475 | 0.444 |",
"| bus            | 0.516 | 0.727  | 0.614  | 0.219 | 0.411 | 0.637 |",
"| train          | 0.436 | 0.7    | 0.5    | 0.338 | 0.201 | 0.467 |",
"| truck          | 0.26  | 0.454  | 0.26   | 0.133 | 0.273 | 0.371 |",
"| boat           | 0.189 | 0.426  | 0.141  | 0.152 | 0.249 | 0.282 |",
"| traffic light  | 0.217 | 0.462  | 0.17   | 0.182 | 0.382 | 0.426 |",
"| fire hydrant   | 0.524 | 0.758  | 0.663  | 0.273 | 0.587 | 0.648 |",
"| stop sign      | 0.52  | 0.637  | 0.623  | 0.199 | 0.568 | 0.799 |",
"| parking meter  | 0.352 | 0.54   | 0.41   | 0.236 | 0.31  | 0.493 |",
"| bench          | 0.171 | 0.302  | 0.181  | 0.1   | 0.167 | 0.286 |",
"| bird           | 0.298 | 0.484  | 0.319  | 0.21  | 0.489 | 0.597 |",
"| cat            | 0.581 | 0.85   | 0.663  | 0.0   | 0.597 | 0.588 |",
"| dog            | 0.51  | 0.728  | 0.584  | 0.291 | 0.543 | 0.541 |",
"| horse          | 0.458 | 0.718  | 0.511  | 0.154 | 0.497 | 0.582 |",
"| sheep          | 0.198 | 0.327  | 0.233  | 0.018 | 0.304 | 0.242 |",
"| cow            | 0.157 | 0.228  | 0.197  | 0.0   | 0.277 | 0.261 |",
"| elephant       | 0.508 | 0.826  | 0.579  | 0.407 | 0.452 | 0.565 |",
"| bear           | 0.517 | 0.762  | 0.614  | 0.0   | 0.556 | 0.567 |",
"| zebra          | 0.537 | 0.86   | 0.603  | 0.413 | 0.542 | 0.609 |",
"| giraffe        | 0.503 | 0.849  | 0.528  | 0.243 | 0.605 | 0.507 |",
"| backpack       | 0.118 | 0.25   | 0.096  | 0.122 | 0.146 | 0.176 |",
"| umbrella       | 0.288 | 0.513  | 0.298  | 0.099 | 0.355 | 0.443 |",
"| handbag        | 0.116 | 0.239  | 0.096  | 0.093 | 0.186 | 0.078 |",
"| tie            | 0.266 | 0.49   | 0.262  | 0.204 | 0.368 | 0.423 |",
"| suitcase       | 0.27  | 0.484  | 0.269  | 0.147 | 0.288 | 0.426 |",
"| frisbee        | 0.519 | 0.712  | 0.626  | 0.465 | 0.566 | 0.795 |",
"| skis           | 0.0   | 0.0    | 0.0    | 0.0   | 0.0   | 0.0   |",
"| snowboard      | 0.0   | 0.0    | 0.0    | 0.0   | 0.0   | 0.0   |",
"| sports ball    | 0.383 | 0.55   | 0.465  | 0.338 | 0.702 | 0.59  |",
"| kite           | 0.259 | 0.411  | 0.311  | 0.287 | 0.263 | 0.111 |",
"| baseball bat   | 0.217 | 0.477  | 0.192  | 0.271 | 0.229 | 0.0   |",
"| baseball glove | 0.287 | 0.498  | 0.323  | 0.238 | 0.382 | 0.269 |",
"| skateboard     | 0.388 | 0.679  | 0.405  | 0.293 | 0.499 | 0.321 |",
"| surfboard      | 0.235 | 0.459  | 0.209  | 0.163 | 0.321 | 0.26  |",
"| tennis racket  | 0.389 | 0.696  | 0.389  | 0.3   | 0.476 | 0.35  |",
"| bottle         | 0.322 | 0.505  | 0.368  | 0.226 | 0.487 | 0.561 |",
"| wine glass     | 0.279 | 0.529  | 0.273  | 0.155 | 0.387 | 0.595 |",
"| cup            | 0.363 | 0.545  | 0.4    | 0.228 | 0.47  | 0.574 |",
"| fork           | 0.204 | 0.393  | 0.165  | 0.098 | 0.342 | 0.235 |",
"| knife          | 0.088 | 0.193  | 0.079  | 0.065 | 0.184 | 0.068 |",
"| spoon          | 0.087 | 0.197  | 0.058  | 0.086 | 0.132 | 0.092 |",
"| bowl           | 0.348 | 0.517  | 0.401  | 0.176 | 0.359 | 0.517 |",
"| banana         | 0.178 | 0.35   | 0.163  | 0.068 | 0.224 | 0.305 |",
"| apple          | 0.133 | 0.215  | 0.147  | 0.022 | 0.224 | 0.276 |",
"| sandwich       | 0.256 | 0.424  | 0.279  | 0.058 | 0.132 | 0.373 |",
"| orange         | 0.234 | 0.328  | 0.275  | 0.073 | 0.296 | 0.41  |",
"| broccoli       | 0.192 | 0.381  | 0.167  | 0.094 | 0.222 | 0.255 |",
"| carrot         | 0.137 | 0.281  | 0.132  | 0.11  | 0.198 | 0.092 |",
"| hot dog        | 0.176 | 0.308  | 0.16   | 0.071 | 0.242 | 0.282 |",
"| pizza          | 0.418 | 0.645  | 0.464  | 0.095 | 0.361 | 0.567 |",
"| donut          | 0.329 | 0.457  | 0.39   | 0.262 | 0.314 | 0.616 |",
"| cake           | 0.245 | 0.448  | 0.24   | 0.142 | 0.285 | 0.327 |",
"| chair          | 0.194 | 0.357  | 0.187  | 0.118 | 0.243 | 0.296 |",
"| couch          | 0.317 | 0.531  | 0.339  | 0.027 | 0.222 | 0.37  |",
"| potted plant   | 0.184 | 0.369  | 0.159  | 0.133 | 0.225 | 0.185 |",
"| bed            | 0.337 | 0.579  | 0.345  | 0.0   | 0.096 | 0.362 |",
"| dining table   | 0.222 | 0.367  | 0.233  | 0.034 | 0.087 | 0.334 |",
"| toilet         | 0.484 | 0.672  | 0.553  | 0.012 | 0.344 | 0.565 |",
"| tv             | 0.452 | 0.674  | 0.515  | 0.099 | 0.443 | 0.561 |",
"| laptop         | 0.46  | 0.686  | 0.53   | 0.117 | 0.333 | 0.594 |",
"| mouse          | 0.508 | 0.731  | 0.573  | 0.389 | 0.635 | 0.666 |",
"| remote         | 0.209 | 0.401  | 0.172  | 0.164 | 0.341 | 0.416 |",
"| keyboard       | 0.403 | 0.637  | 0.448  | 0.107 | 0.414 | 0.486 |",
"| cell phone     | 0.266 | 0.449  | 0.271  | 0.148 | 0.412 | 0.451 |",
"| microwave      | 0.467 | 0.667  | 0.621  | 0.021 | 0.485 | 0.554 |",
"| oven           | 0.248 | 0.433  | 0.262  | 0.044 | 0.184 | 0.324 |",
"| toaster        | 0.267 | 0.391  | 0.391  | 0.47  | 0.278 | 0.088 |",
"| sink           | 0.251 | 0.448  | 0.25   | 0.157 | 0.313 | 0.285 |",
"| refrigerator   | 0.394 | 0.613  | 0.415  | 0.0   | 0.083 | 0.481 |",
"| book           | 0.114 | 0.264  | 0.081  | 0.115 | 0.147 | 0.101 |",
"| clock          | 0.44  | 0.699  | 0.462  | 0.347 | 0.541 | 0.502 |",
"| vase           | 0.283 | 0.484  | 0.288  | 0.205 | 0.308 | 0.453 |",
"| scissors       | 0.112 | 0.182  | 0.098  | 0.012 | 0.294 | 0.092 |",
"| teddy bear     | 0.343 | 0.613  | 0.367  | 0.088 | 0.348 | 0.452 |",
"| hair drier     | 0.01  | 0.033  | 0.0    | 0.0   | 0.05  | 0.0   |",
"| toothbrush     | 0.115 | 0.266  | 0.117  | 0.102 | 0.138 | 0.362 |",
]

"""
pattern:10+5, task0 mAP: 0.7413000000000001
pattern:10+5, task1 mAP: 0.7708
all mAP: 0.7511333333333332

pattern:10+5, task0 mAP: 0.768
pattern:10+5, task1 mAP: 0.8166
all mAP: 0.7841999999999999

pattern:10+5+5, task0 mAP: 0.7531
pattern:10+5+5, task1 mAP: 0.8061999999999999
pattern:10+5+5, task2 mAP: 0.6100000000000001
all mAP: 0.7306

pattern:10+5+5, task0 mAP: 0.7016000000000001
pattern:10+5+5, task1 mAP: 0.7158
pattern:10+5+5, task2 mAP: 0.5806

pattern:10+5, task0 mAP: 0.7413000000000001
pattern:10+5, task1 mAP: 0.7708
all mAP: 0.7511333333333332

pattern:10+5+5, task0 mAP: 0.7016000000000001
pattern:10+5+5, task1 mAP: 0.7158
pattern:10+5+5, task2 mAP: 0.5806
all mAP: 0.6749

pattern:10+5, task0 mAP: 0.768
pattern:10+5, task1 mAP: 0.8166
all mAP: 0.7841999999999999

pattern:10+5+5, task0 mAP: 0.7461
pattern:10+5+5, task1 mAP: 0.7944000000000001
pattern:10+5+5, task2 mAP: 0.6298
all mAP: 0.7291000000000001

weight-GEM
pattern:5+15, task0 mAP: 0.6994
pattern:5+15, task1 mAP: 0.7599333333333332
all mAP: 0.7447999999999999

weight
pattern:5+15, task0 mAP: 0.6736
pattern:5+15, task1 mAP: 0.7689333333333331
all mAP: 0.7451


"""

# assert len(map_list) == 20
class_to_map = []
for mAP in map_list:
    items = re.split(r'\|', mAP)
    cleaned_items = [item.strip() for item in items if item.strip()]
    class_name = cleaned_items[0]
    ap = float(cleaned_items[1])
    # print(class_name, class_num, ap)
    class_to_map.append((class_name, ap))

for pattern in patterns:
    parts = pattern.split('+')
    begin = 0
    for task_id, part in enumerate(parts):
        begin_index = begin
        end_index = begin + int(part)
        mAP = 0
        for (class_name, ap) in class_to_map[begin_index:end_index]:
            # print(ap, class_num, all_num)
            mAP += ap
            # mAP += ap * class_num / all_num
        mAP = mAP / int(part)
        print("pattern:{}, task{} mAP: {}".format(pattern, task_id, mAP))
        begin += int(part)

    mAP = 0
    for (class_name,  ap) in class_to_map:
        # print(ap, class_num, all_num)
        mAP += ap
        # mAP += ap * class_num / all_num
    mAP = mAP / len(class_to_map)
    print("all mAP: {}".format(mAP))